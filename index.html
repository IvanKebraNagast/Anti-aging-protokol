<html lang="sk">
<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Aging Protokol</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .container { max-width: 600px; margin: auto; }
        .tab-button.active { background-color: #3b82f6; color: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -2px rgba(0,0,0,.1); }
        .pill { background-color: #ecfdf5; border-left: 4px solid #10b981; }
        .info-btn { font-weight: 700; border-radius: 9999px; padding: 0 8px; line-height: 20px; }
        .content-section { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('debug');

        let db, auth, userId;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        // Vytvorenie referencie na dokument pre ukladanie stavu u≈æ√≠vateƒæa
        const getChecklistDocRef = () => (db && userId) ? doc(db, `artifacts/${appId}/users/${userId}/anti_aging_protocol`, 'checklist_state') : null;

        // ---------- INFO TEXTY (slovenƒçina) ----------
        const INFO = {
          // AKTUALIZOVAN√â pre N√≠zky Z√°pal (Pillar 1)
          'low_inflammation': '√Åno, ≈æiadny cukor a prepaƒæovan√© oleje. Chronick√Ω z√°pal je hlavn√Ω ur√Ωchƒæovaƒç starnutia, preto sa vyh√Ωbaj jednoduch√Ωm cukrom a spracovan√Ωm, prep√°len√Ωm rastlinn√Ωm olejom (slneƒçnicov√Ω, repkov√Ω, s√≥jov√Ω). Polyfenoly (olivov√Ω olej, ƒçuƒçoriedky, zelen√Ω ƒçaj) s√∫ siln√© antioxidanty, ktor√© z√°pal zni≈æuj√∫ ‚Äì √ÅNO, s√∫ kƒæ√∫ƒçov√©!',
          
          // AKTUALIZOVAN√â pre Autof√°giu (Pillar 2)
          'autofagia': 'Autof√°gia = telov√° recykl√°cia (doslova ‚Äûsebapo≈æieranie‚Äú). Telo poƒças nej ƒçist√≠ po≈°koden√© a nefunkƒçn√© bunky a opravuje sa. Sp√∫≈°≈•a ju obmedzenie kal√≥ri√≠ ‚Äì p√¥st (napr. 16/8 alebo 24‚Äì48 h) a spermid√≠n. Je to kƒæ√∫ƒçov√Ω mechanizmus dlhovekosti.',
          
          // AKTUALIZOVAN√â pre Saunu a chlad (Pillar 3)
          'sauna_chlad': 'Teplo a chlad s√∫ horm√©za, ktor√° extr√©mne prospieva mitochondri√°m. Postup: 1. Sauna (80‚Äì100 ¬∞C, 10‚Äì15 min) ‚Üí 2. Studen√° voda/sprcha (10‚Äì15 ¬∞C, 30‚Äì60 s) ‚Üí Zopakuj 2‚Äì3 cykly. Teplo zap√≠na HSP (heat-shock prote√≠ny), chlad obnovuje mitochondrie a hned√Ω tuk. Odpor√∫ƒça sa 2‚Äì3 kr√°t do t√Ω≈æd≈àa.',
          
          // AKTUALIZOVAN√â pre P√¥st (Autof√°gia detaily)
          'eatingwindow': 'Jes≈• v okne 8‚Äì10 hod√≠n = v≈°etko jedlo d≈àa zje≈° napr. medzi 10:00‚Äì18:00 (8h okno). Zvy≈°n√Ωch 14‚Äì16 hod√≠n je p√¥st (iba voda, nesladen√Ω ƒçaj, ƒçierna k√°va). Teda, **16h sa neje, 8h sa je** (napr. 10:00-18:00). Dlh≈°ie p√¥sty (24‚Äì48 h) znamenaj√∫ **24h alebo 48h nejes≈•**, len pi≈• tekutiny.',
          
          'hiit': 'Kr√°tky intenz√≠vny tr√©ning: 30 sek√∫nd r√Ωchlo / 30 sek√∫nd pomaly √ó 4‚Äì6 k√¥l (trv√° 4‚Äì6 min). M√¥≈æe≈°: jumping jacks, r√Ωchle drepy, ≈°print na mieste alebo bicykel (20 s naplno / 40 s ƒæahko √ó 8).',
          'omad': 'Jedno jedlo denne (OMAD) = 1 jedlo v 24 hodin√°ch. Rob 2√ó do t√Ω≈æd≈àa. Dovolen√©: voda, nesladen√Ω ƒçaj, ƒçierna k√°va.',
          
          'fisetin': 'Fiset√≠n ‚Äì senol√Ωza: 2 dni po sebe, vysok√° d√°vka (cca 20 mg/kg hmotnosti/de≈à; pri 77 kg ~1500 mg/de≈à). U≈æ√≠vaj s tukom (napr. olivov√Ω olej, vajcia). V tie dni neber siln√© antioxidanty.',
          'drepy_L1': 'Stoliƒçkov√© drepy: Postav sa pred stoliƒçku (nohy na ≈°√≠rku ramien), √∫plne si sadni a bez pomoci r√∫k vsta≈à. Opakuj 15‚Äì20√ó. Pou≈æ√≠va sa pri Leveli 1.',
          'drepy_L2': 'Klasick√© drepy: Zadok dozadu ako pri sadan√≠, chrb√°t rovn√Ω, kolen√° nepredbiehaj√∫ prsty. 15‚Äì20√ó. Pou≈æ√≠va sa pri Leveli 2.',
          'drepy_L3': 'Jumping drepy: Drep ‚Üí v√Ωskok ‚Üí drep. M√§kko dopada≈•, 10‚Äì12√ó. Vynechaj pri bolesti kolien. Pou≈æ√≠va sa pri Leveli 3.',
          'ritual': 'Rann√Ω 5-min ritu√°l: Drepy (podƒæa √∫rovne) 15‚Äì20√ó, Kliky 8‚Äì12√ó (alebo o stenu), Plank 30‚Äì40 s. 2 kol√°.',
        };
        window.INFO = INFO; // Exponovanie pre glob√°lne volanie infoModal

        const todayStr = () => new Date().toISOString().slice(0,10);

        // Funkcie na z√≠skanie kƒæ√∫ƒça pre t√Ω≈æde≈à a mesiac
        const isoWeekKey = (d=new Date()) => {
          const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
          const dayNum = date.getUTCDay() || 7;
          date.setUTCDate(date.getUTCDate() + 4 - dayNum);
          const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
          const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
          return `${date.getUTCFullYear()}-W${String(weekNo).padStart(2,'0')}`;
        };
        const isoMonthKey = (d=new Date()) => d.toISOString().slice(0, 7);

        // Kontrola, ƒçi bol de≈à vƒçera (pre streak)
        const isYesterday = (ds) => {
          if (!ds) return false;
          const d1 = new Date(ds); 
          const d2 = new Date(todayStr());
          const diff = Math.round((d2.getTime() - d1.getTime()) / 86400000); // Rozdiel v d≈àoch
          return diff === 1;
        };

        // Ulo≈æenie stavu do Firestore
        window.saveChecklistState = async (state) => {
          const docRef = getChecklistDocRef();
          if (!docRef) return;
          try { await setDoc(docRef, state, { merge: true }); }
          catch(e){ console.error('Chyba ulo≈æenia do Firestore:', e); }
        };

        // Aplik√°cia stavu z Firestore na UI + Resetovacia logika
        const applyChecklistState = (state) => {
          // Inicializ√°cia default stavov pre cviƒçenie a resety
          if (![1,2,3].includes(state.squatLevel)) state.squatLevel = 1;
          if (typeof state.squatStreak !== 'number') state.squatStreak = 0;
          if (!state.lastMonthlyReset) state.lastMonthlyReset = isoMonthKey();
          if (!state.lastWeeklyReset) state.lastWeeklyReset = isoWeekKey();
          
          let newState = { ...state };
          const today = todayStr();
          let stateChanged = false;

          // 1. DENN√ù RESET
          const lastDailyReset = newState.lastDailyReset || '2000-01-01';
          if (today !== lastDailyReset) {
            const keysToKeep = Object.keys(newState).filter(k => 
                k.startsWith('weekly-') || k.startsWith('monthly-') || 
                ['lastWeeklyReset', 'lastMonthlyReset', 'squatLevel', 'squatStreak', 'lastSquatTick'].includes(k)
            );
            
            const newDaily = {};
            keysToKeep.forEach(k => newDaily[k] = newState[k]);
            newState = { ...newDaily, lastDailyReset: today };
            stateChanged = true;
          }

          // 2. T√ù≈ΩDENN√ù RESET
          const wk = isoWeekKey();
          if (wk !== newState.lastWeeklyReset) {
            Object.keys(newState).forEach(k => { if (k.startsWith('weekly-')) delete newState[k]; });
            newState.lastWeeklyReset = wk;
            stateChanged = true;
          }

          // 3. MESAƒåN√ù RESET
          const monthKey = isoMonthKey();
          if (monthKey !== newState.lastMonthlyReset) {
            Object.keys(newState).forEach(k => { if (k.startsWith('monthly-')) delete newState[k]; });
            newState.lastMonthlyReset = monthKey;
            stateChanged = true;
          }

          if (stateChanged) {
            window.saveChecklistState(newState);
          }

          // Aplik√°cia stavu na checkbox
          document.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
            const id = cb.id;
            if (id.startsWith('daily-') || id.startsWith('weekly-') || id.startsWith('monthly-')) {
              cb.checked = !!newState[id];
            }
          });

          // Aktualiz√°cia UI
          renderTrainingUI(newState);
          renderFisetinPanel();
        };

        // Logika pre sledovanie a levelovanie drepov
        function updateSquatProgressFromUI(state){
          const chk = document.getElementById('daily-squats');
          if (!chk) return state;
          
          let currentState = {...state};
          
          if (chk.checked) {
            const lastTick = currentState.lastSquatTick || '';
            const today = todayStr();
            
            if (lastTick !== today) {
              if (isYesterday(lastTick)) {
                currentState.squatStreak = (currentState.squatStreak || 0) + 1;
              } else {
                currentState.squatStreak = 1; // Nov√° s√©ria
              }
              currentState.lastSquatTick = today;
              
              if (currentState.squatStreak >= 7 && currentState.squatLevel < 3) {
                currentState.squatLevel += 1;
                currentState.squatStreak = 0;
                window.infoModal('√örove≈à cviƒçenia zv√Ω≈°en√°',
                  `Gratulujem! Odomkol si Level ${currentState.squatLevel}. Tvoj tr√©ning sa automaticky prepol na vy≈°≈°iu √∫rove≈à.`,
                  'OK');
              }
            }
          } else {
            // Ak u≈æ√≠vateƒæ od≈°krtne √∫lohu
            if (currentState.lastSquatTick === todayStr()) {
               // Ak bola od≈°krtnut√° v ten ist√Ω de≈à, rollback sa nekomplikuje, ale len sa resetuje denn√Ω stav
               currentState.lastSquatTick = isYesterday(currentState.lastSquatTick) ? todayStr() : ''; // Zru≈°√≠ tick, ale nech√° streak
            }
          }
          renderTrainingUI(currentState);
          return currentState;
        }

        // Vykreslenie UI pre drepy
        function renderTrainingUI(state){
          const lvlEl = document.getElementById('squat-level-val');
          const streakEl = document.getElementById('squat-streak-val');
          const labelEl = document.getElementById('daily-squats-label');

          const levelNames = {1:'Level 1 ‚Äì Stoliƒçkov√© drepy', 2:'Level 2 ‚Äì Klasick√© drepy', 3:'Level 3 ‚Äì Jumping drepy'};
          const levelInstr = {
            1:'15‚Äì20√ó: sadni si na stoliƒçku a vsta≈à bez r√∫k.',
            2:'15‚Äì20√ó: drep bez stoliƒçky, zadok dozadu, chrb√°t rovn√Ω.',
            3:'10‚Äì12√ó: drep ‚Üí v√Ωskok ‚Üí drep. M√§kk√Ω dopad.'
          };
          const currentLevel = state.squatLevel || 1;
          const currentStreak = state.squatStreak || 0;

          if (lvlEl){ lvlEl.textContent = levelNames[currentLevel]; lvlEl.dataset.level = currentLevel; }
          if (streakEl){ streakEl.textContent = `${currentStreak} / 7 dn√≠`; streakEl.dataset.streak = currentStreak; streakEl.dataset.last = state.lastSquatTick || ''; }
          if (labelEl){ labelEl.innerHTML = `Drepy <span class="text-sm text-gray-500">(${levelInstr[currentLevel]})</span>`; }
        }

        // V√Ωpoƒçet dn√≠ do najbli≈æ≈°ieho Fiset√≠nu (De≈à 12)
        function calculateNextFisetin() {
          const now = new Date();
          const fisetinDayOfMonth = 12; // De≈à, kedy sa zaƒç√≠na Fiset√≠n
          
          let fisetinDate = new Date(now.getFullYear(), now.getMonth(), fisetinDayOfMonth);
          fisetinDate.setHours(0, 0, 0, 0); // Nastav na polnoci

          const today = new Date();
          today.setHours(0, 0, 0, 0); // Dne≈°n√Ω de≈à

          // Ak u≈æ sme po 13. dni, nastav Fiset√≠n na bud√∫ci mesiac
          if (now.getDate() > 13) {
            fisetinDate = new Date(now.getFullYear(), now.getMonth() + 1, fisetinDayOfMonth);
            fisetinDate.setHours(0, 0, 0, 0);
          }
          
          const diffTime = fisetinDate.getTime() - today.getTime();
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          // Ak je dnes de≈à 12 alebo 13, uk√°≈æe 0 alebo -1, ale pre UI chceme uk√°za≈• 0 (DNES/ZAJTRA)
          if (diffDays <= 1) {
            return 0;
          }
          
          return Math.max(0, diffDays);
        }

        // Vykreslenie Fisetin panelu
        function renderFisetinPanel(){
          const days = calculateNextFisetin();
          const panel = document.getElementById('fisetin-next-display');
          if (!panel) return;

          const plural = (n) => (n === 1 ? 'DE≈á' : (n >= 2 && n <= 4 ? 'DNI' : 'DN√ç'));

          if (days <= 0) {
            panel.innerHTML = '<span class="text-red-700 font-bold">üî• DNES/ZAJTRA!</span> Senol√Ωza Fiset√≠n.';
            panel.className = 'p-4 rounded-xl shadow-md border-l-4 border-red-500 bg-red-100 text-gray-700 text-lg font-medium mb-6';
          } else if (days <= 7) {
            panel.innerHTML = `<span class="text-orange-700 font-bold">‚ö†Ô∏è ${days} ${plural(days)}</span> do Fiset√≠nu (De≈à 12). Priprav sa.`;
            panel.className = 'p-4 rounded-xl shadow-md border-l-4 border-orange-500 bg-orange-100 text-gray-700 text-lg font-medium mb-6';
          } else {
            panel.innerHTML = `<span><span class="font-bold">${days} ${plural(days)}</span> do Fiset√≠nu (De≈à 12).</span>`;
            panel.className = 'p-4 rounded-xl shadow-md border-l-4 border-blue-500 bg-blue-100 text-gray-700 text-lg font-medium mb-6';
          }
        }

        // Naƒç√≠tanie stavu z Firestore a nastavenie real-time listenera
        const loadChecklistState = () => {
          const ref = getChecklistDocRef();
          if (!ref) return;
          onSnapshot(ref, (docSnap)=>{
            if (docSnap.exists()) {
              applyChecklistState(docSnap.data());
            } else {
              // Ak dokument neexistuje, inicializujeme s pr√°zdnym stavom (ƒçist√Ω UI)
              applyChecklistState({});
            }
          }, (err)=>console.error('onSnapshot error', err));
        };

        // Zostavenie stavu z aktu√°lneho UI
        const buildStateFromUI = () => {
          const newState = {};
          document.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
            if (cb.id.startsWith('daily-') || cb.id.startsWith('weekly-') || cb.id.startsWith('monthly-')) {
              newState[cb.id] = cb.checked;
            }
          });
          // Pridanie inform√°ci√≠ o √∫rovni drepov
          const lvl = Number(document.getElementById('squat-level-val')?.dataset.level || 1);
          const streak = Number(document.getElementById('squat-streak-val')?.dataset.streak || 0);
          newState.squatLevel = lvl;
          newState.squatStreak = streak;
          const lst = document.getElementById('squat-streak-val')?.dataset.last || '';
          if (lst) newState.lastSquatTick = lst;
          
          // Pridanie reset kƒæ√∫ƒçov
          newState.lastMonthlyReset = isoMonthKey();
          newState.lastWeeklyReset = isoWeekKey();
          // Posledn√Ω daily reset sa prid√° len pri √∫spe≈°nej zmene (v applyChecklistState alebo manualDailyReset)
          // Tu ho nech√°me tak ako je v DB, aby sme nespustili nechcen√Ω reset pri ka≈ædej zmene
          
          return newState;
        };

        // Nastavenie listenerov pre v≈°etky checkbox a info tlaƒçidl√°
        const setupChecklistListeners = () => {
          document.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
            cb.addEventListener('change', ()=>{
              let state = buildStateFromUI();
              state = updateSquatProgressFromUI(state); // Aktualizuj streak a level
              state.lastDailyReset = todayStr(); // Potvrdzujeme denn√Ω stav
              window.saveChecklistState(state);
            });
          });

          document.querySelectorAll('[data-info]').forEach(btn=>{
            btn.addEventListener('click', ()=>{
              const key = btn.dataset.info;
              window.infoModal(btn.dataset.title || 'Inform√°cia', INFO[key] || '‚Ä¶');
            });
          });
        };
        
        // Pomocn√° funkcia pre hromadn√© oznaƒçenie Rann√©ho stacku (pre Shortcuts)
        window.markMorningStackDone = () => {
          const ids = ['daily-water', 'daily-sunlight', 'daily-squats', 'daily-ritual', 'daily-breakfast'];
          ids.forEach(id => {
            const cb = document.getElementById(id);
            if (cb && !cb.checked) cb.checked = true;
          });
          let state = buildStateFromUI();
          state = updateSquatProgressFromUI(state);
          state.lastDailyReset = todayStr();
          window.saveChecklistState(state);
        };
        
        // Pomocn√° funkcia pre hromadn√© oznaƒçenie Veƒçern√©ho stacku (pre Shortcuts)
        window.markNightStackDone = () => {
          const ids = ['daily-lastmeal', 'daily-nightstack', 'daily-screenoff', 'daily-sleep'];
          ids.forEach(id => {
            const cb = document.getElementById(id);
            if (cb && !cb.checked) cb.checked = true;
          });
          let state = buildStateFromUI();
          state.lastDailyReset = todayStr();
          window.saveChecklistState(state);
        };

        // Inicializ√°cia aplik√°cie a prihl√°senie
        const initApp = async () => {
          try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Overenie a prihl√°senie pomocou custom tokenu alebo anonymn√© prihl√°senie
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
              await signInWithCustomToken(auth, __initial_auth_token);
            } else {
              await signInAnonymously(auth);
            }

            // Listener pre zmeny stavu prihl√°senia
            onAuthStateChanged(auth, (user) => {
              if (user) {
                userId = user.uid;
                document.getElementById('user-id-display').textContent = `ID: ${userId}`;
                loadChecklistState(); // Naƒç√≠tanie d√°t po √∫spe≈°nom prihl√°sen√≠
                setupChecklistListeners();
              } else {
                document.getElementById('user-id-display').textContent = `ID: N/A`;
              }
            });

          } catch (e) {
            console.error('Chyba pri inicializ√°cii Firebase:', e);
            document.getElementById('error-message').textContent = 'Chyba pri pripojen√≠ k DB. Skontroluj konzolu.';
          }
        };
        window.onload = initApp;
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container p-4 sm:p-6 bg-white shadow-xl min-h-screen">
    <header class="mb-6 pb-4 border-b border-gray-200">
      <h1 class="text-3xl font-bold text-gray-900 text-center mb-1">üî• ANTI-AGING PROTOKOL</h1>
      <p class="text-sm text-gray-500 text-center mb-3">Tvoj sprievodca dlhovekos≈•ou a regener√°ciou</p>
      <div id="user-id-display" class="text-xs text-gray-400 text-center truncate">ID: Naƒç√≠tavam...</div>
      <div id="error-message" class="text-red-500 text-sm text-center font-medium"></div>
    </header>

    <nav class="flex justify-center space-x-2 sm:space-x-4 mb-6 sticky top-0 bg-white pt-2 z-10 border-b border-gray-100 -mx-4 sm:mx-0 px-4 sm:px-0">
      <button data-target="overview" class="tab-button active flex-1 sm:flex-none px-3 py-2 text-sm font-medium rounded-lg transition">Prehƒæad</button>
      <button data-target="daily" class="tab-button flex-1 sm:flex-none px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 transition">Denn√Ω Re≈æim</button>
      <button data-target="monthly" class="tab-button flex-1 sm:flex-none px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 transition">Reset Kalend√°r</button>
      <button data-target="tests" class="tab-button flex-1 sm:flex-none px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 transition">Krvn√© Testy</button>
    </nav>

    <!-- 1. PREHƒΩAD -->
    <div id="overview" class="content-section">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">5 Pilierov ‚ÄûVeƒçnej Mladosti‚Äú</h2>

      <div class="space-y-4">
        <!-- AKTUALIZOVAN√â: Pillar 1 - N√≠zky Z√°pal -->
        <div class="p-4 rounded-xl pill shadow-sm flex items-start justify-between">
          <div>
            <p class="text-lg font-bold text-green-700">1Ô∏è‚É£ N√≠zky Z√°pal + N√≠zka Glyk√©mia</p>
            <p class="text-sm text-gray-600 mt-1">≈Ωiadny cukor, prepaƒæovan√© oleje (‚ùå). Polyfenoly (olivov√Ω olej, ƒçuƒçoriedky) (‚úÖ).</p>
          </div>
          <button class="info-btn bg-green-100 text-green-800" data-info="low_inflammation" data-title="Z√°pal a glyk√©mia ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
        </div>

        <!-- AKTUALIZOVAN√â: Pillar 2 - Autof√°gia (Prehƒæad) -->
        <div class="p-4 rounded-xl pill shadow-sm flex items-start justify-between">
          <div>
            <p class="text-lg font-bold text-green-700">2Ô∏è‚É£ Autof√°gia (Telov√° recykl√°cia)</p>
            <p class="text-sm text-gray-600 mt-1">P√¥st 16/8, OMAD 2√ó t√Ω≈ædenne, 48 h p√¥st 1√ó mesaƒçne, spermid√≠n.</p>
          </div>
          <button class="info-btn bg-green-100 text-green-800" data-info="eatingwindow" data-title="P√¥st a okn√° jedenia ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
        </div>

        <!-- AKTUALIZOVAN√â: Pillar 3 - Mitochondrie (Pridan√© info tlaƒçidlo) -->
        <div class="p-4 rounded-xl pill shadow-sm flex items-start justify-between">
          <div>
            <p class="text-lg font-bold text-green-700">3Ô∏è‚É£ Mitochondrie (Motor Mladosti)</p>
            <p class="text-sm text-gray-600 mt-1">Studen√° voda, sauna, kr√°tky intenz√≠vny tr√©ning. Doplnky: creatine, CoQ10, PQQ, L-carnitine. Sp√°nok 7‚Äì9 h.</p>
          </div>
          <button class="info-btn bg-green-100 text-green-800" data-info="sauna_chlad" data-title="Sauna + chlad protokol ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
        </div>

        <div class="p-4 rounded-xl pill shadow-sm">
          <p class="text-lg font-bold text-green-700">4Ô∏è‚É£ Svaly (Org√°n Dlh√©ho ≈Ωivota)</p>
          <p class="text-sm text-gray-600 mt-1">Silov√Ω tr√©ning kr√°tko, ale pravidelne. Bielkoviny 1.5‚Äì2 g/kg denne.</p>
        </div>

        <div class="p-4 rounded-xl pill shadow-sm">
          <p class="text-lg font-bold text-green-700">5Ô∏è‚É£ Hormon√°lna Rovnov√°ha</p>
          <p class="text-sm text-gray-600 mt-1">DHEA, testoster√≥n, IGF-1, melaton√≠n ‚Äì keƒè padn√∫, starnutie zr√Ωchli 3√ó.</p>
        </div>
      </div>

      <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4 border-b pb-2">‚ö†Ô∏è Najv√§ƒç≈°√≠ Zabijaci Mladosti</h3>
      <ul class="grid grid-cols-2 gap-3 text-sm">
        <li class="bg-red-100 text-red-800 p-2 rounded-lg font-medium">‚ùå Chronick√Ω stres / kortizol</li>
        <li class="bg-red-100 text-red-800 p-2 rounded-lg font-medium">‚ùå Vysoko spracovan√© jedl√°</li>
        <li class="bg-red-100 text-red-800 p-2 rounded-lg font-medium">‚ùå Viscer√°lny tuk (= brucho)</li>
        <li class="bg-red-100 text-red-800 p-2 rounded-lg font-medium">‚ùå Alkohol vo veƒækom</li>
        <li class="bg-red-100 text-red-800 p-2 rounded-lg font-medium">‚ùå Nedostatok sp√°nku</li>
        <li class="bg-red-100 text-red-800 p-2 rounded-lg font-medium">‚ùå M√°lo svalov</li>
      </ul>
    </div>

    <!-- 2. DENN√ù RE≈ΩIM -->
    <div id="daily" class="content-section hidden">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">‚úÖ Denn√Ω Anti-Aging Re≈æim</h2>
      <p class="text-sm text-gray-500 mb-4">Omladzuj√∫ci ritu√°l pre ka≈æd√∫ ƒças≈• d≈àa. Za≈°krtni splnen√© √∫lohy.</p>

      <!-- Centr√°lne tlaƒçidl√° pre iOS Shortcuts -->
      <button onclick="markMorningStackDone()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition mt-4 mb-2">
        Oznaƒç RANN√ù STACK Hotov√Ω (pre Shortcuts)
      </button>

      <div class="space-y-6">
        <!-- R√ÅNO -->
        <div class="bg-blue-50 p-4 rounded-xl shadow-md">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-lg font-bold text-blue-800">üïí R√ÅNO (0‚Äì60 min po zobuden√≠)</h3>
            <button class="info-btn bg-blue-100 text-blue-800" data-info="ritual" data-title="Rann√Ω ritu√°l ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
          </div>
          <ul class="space-y-2">
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-water" class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
              <label for="daily-water" class="text-gray-700 select-none">Vypi 0,5 L vody + ≈°tipka soli</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-sunlight" class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
              <label for="daily-sunlight" class="text-gray-700 select-none">Slneƒçn√© svetlo do oƒç√≠ / vonku 3‚Äì5 min</label>
            </li>

            <!-- LEVELOV√ù BLOK: DREPY -->
            <li class="flex items-center justify-between">
              <div>
                <span id="daily-squats-label" class="text-gray-700 font-medium">Drepy (zvol√≠ sa podƒæa √∫rovne)</span>
                <div class="text-xs text-gray-500">
                  <span class="font-semibold">Aktu√°lna √∫rove≈à:</span> <span id="squat-level-val" data-level="1">Level 1 ‚Äì Stoliƒçkov√© drepy</span> ‚Ä¢
                  <span class="font-semibold">S√©ria:</span> <span id="squat-streak-val" data-streak="0">0 / 7 dn√≠</span>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <button class="info-btn bg-blue-100 text-blue-800" data-info="drepy_L1" data-title="Drepy ‚Äì √∫rovne ‚ÑπÔ∏è" onclick="window.cycleSquatInfo()">‚ÑπÔ∏è</button>
                <input type="checkbox" id="daily-squats" class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500" title="Oznaƒç po dokonƒçen√≠ dne≈°n√Ωch drepov">
              </div>
            </li>

            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-ritual" class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
              <label for="daily-ritual" class="text-gray-700 select-none">5-min√∫tov√Ω silov√Ω ritu√°l (Drepy/Kliky/Plank)</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-breakfast" class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
              <label for="daily-breakfast" class="text-gray-700 select-none">Doplnky a ra≈àajky (Bielkoviny + Tuky, nie cukor)</label>
            </li>
          </ul>
        </div>

        <!-- VEƒåER -->
        <button onclick="markNightStackDone()" class="w-full bg-purple-600 text-white py-2 rounded-lg font-bold hover:bg-purple-700 transition mt-4 mb-2">
          Oznaƒç VEƒåERN√ù STACK Hotov√Ω (pre Shortcuts)
        </button>
        <div class="bg-purple-50 p-4 rounded-xl shadow-md">
          <h3 class="text-lg font-bold text-purple-800 border-b border-purple-200 pb-2 mb-3">üïí VEƒåER (18:00 ‚Äì 22:30)</h3>
          <ul class="space-y-2">
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-lastmeal" class="h-5 w-5 text-purple-600 rounded focus:ring-purple-500">
              <label for="daily-lastmeal" class="text-gray-700 select-none">Posledn√© jedlo max. 3h pred span√≠m</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-nightstack" class="h-5 w-5 text-purple-600 rounded focus:ring-purple-500">
              <label for="daily-nightstack" class="text-gray-700 select-none">Magn√©zium + Ashwagandha (Night Stack)</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-screenoff" class="h-5 w-5 text-purple-600 rounded focus:ring-purple-500">
              <label for="daily-screenoff" class="text-gray-700 select-none">≈Ωiadny alkohol, ≈æiadne modr√© svetlo po 22:00</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-sleep" class="h-5 w-5 text-purple-600 rounded focus:ring-purple-500">
              <label for="daily-sleep" class="text-gray-700 select-none">Sp√°nok do 23:00 (7‚Äì9 h, izba 18‚Äì19 ¬∞C)</label>
            </li>
          </ul>
        </div>

        <!-- CELODENN√â Z√ÅSADY -->
        <div class="bg-green-50 p-4 rounded-xl shadow-md">
          <h3 class="text-lg font-bold text-green-800 border-b border-green-200 pb-2 mb-3">üü¢ CELODENN√â Z√ÅSADY</h3>
          <ul class="space-y-2">
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-hydration" class="h-5 w-5 text-green-600 rounded focus:ring-green-500">
              <label for="daily-hydration" class="text-gray-700 select-none">Hydrat√°cia + K√°va/Zelen√Ω ƒçaj (polyfenoly)</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-steps" class="h-5 w-5 text-green-600 rounded focus:ring-green-500">
              <label for="daily-steps" class="text-gray-700 select-none">Min. 7 000 krokov / po jedle 5 min ch√¥dze</label>
            </li>
            <li class="flex items-center space-x-2">
              <input type="checkbox" id="daily-eatingwindow" class="h-5 w-5 text-green-600 rounded focus:ring-green-500">
              <label for="daily-eatingwindow" class="text-gray-700 select-none">Jes≈• v okne 8‚Äì10 hod√≠n denne</label>
              <button class="info-btn bg-green-100 text-green-800" data-info="eatingwindow" data-title="ƒåasov√© okno jedenia ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
            </li>
          </ul>
        </div>

        <!-- T√ù≈ΩDENN√â √öLOHY -->
        <div class="bg-amber-50 p-4 rounded-xl shadow-md">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-lg font-bold text-amber-800">üìÖ T√ù≈ΩDENN√â √öLOHY (auto-reset ka≈æd√Ω t√Ω≈æde≈à)</h3>
            <div class="flex items-center space-x-2">
              <button class="info-btn bg-amber-100 text-amber-800" data-info="hiit" data-title="Kr√°tky intenz√≠vny tr√©ning ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
              <button class="info-btn bg-amber-100 text-amber-800" data-info="omad" data-title="Jedno jedlo denne ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
            </div>
          </div>
          <ul class="space-y-2">
            <li class="flex items-center justify-between">
              <span class="text-gray-700 select-none">Kr√°tky intenz√≠vny tr√©ning (2√ó do t√Ω≈æd≈àa)</span>
              <div class="flex items-center space-x-2">
                <input type="checkbox" id="weekly-hiit-1" class="h-5 w-5 text-amber-600 rounded focus:ring-amber-500" title="HIIT ‚Äì s√©ria 1">
                <input type="checkbox" id="weekly-hiit-2" class="h-5 w-5 text-amber-600 rounded focus:ring-amber-500" title="HIIT ‚Äì s√©ria 2">
              </div>
            </li>
            <li class="flex items-center justify-between">
              <span class="text-gray-700 select-none">Jedno jedlo denne (OMAD) ‚Äì 2√ó do t√Ω≈æd≈àa</span>
              <div class="flex items-center space-x-2">
                <input type="checkbox" id="weekly-omad-1" class="h-5 w-5 text-amber-600 rounded focus:ring-amber-500" title="OMAD ‚Äì de≈à 1">
                <input type="checkbox" id="weekly-omad-2" class="h-5 w-5 text-amber-600 rounded focus:ring-amber-500" title="OMAD ‚Äì de≈à 2">
              </div>
            </li>
          </ul>
        </div>

        <!-- Manu√°lny reset d≈àa -->
        <button onclick="manualDailyReset()" class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg font-medium hover:bg-gray-300 transition">Manu√°lne Resetova≈• Denn√© √ölohy</button>
      </div>
    </div>

    <!-- 3. MESAƒåN√ù RESET -->
    <div id="monthly" class="content-section hidden">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">üìÖ Mesaƒçn√Ω Longevity Reset (1.0)</h2>
        <button class="info-btn bg-indigo-100 text-indigo-800" data-info="sauna_chlad" data-title="Teplo + chlad protokol ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
      </div>

      <!-- FISETIN PANEL -->
      <div id="fisetin-next-display" data-last-monthly-reset="" class="p-4 rounded-xl shadow-md border-l-4 border-blue-500 bg-blue-100 text-gray-700 text-lg font-medium mb-6">
        Naƒç√≠tavam...
      </div>

      <p class="text-sm text-gray-500 mb-4">30-d≈àov√Ω cyklus: senol√Ωza + autof√°gia + mitochondrie. <span class="font-bold text-red-600">Automaticky sa resetuje 1. de≈à v mesiaci.</span></p>

      <div class="space-y-3">
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 5: 18‚Äì24 h p√¥st</span>
          <input type="checkbox" id="monthly-day5" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 7: Sauna + studen√° sprcha (2‚Äì3 cykly)</span>
          <input type="checkbox" id="monthly-day7" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 10: 24 h bez sacharidov</span>
          <input type="checkbox" id="monthly-day10" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-red-100 rounded-xl shadow-sm flex justify-between items-center border border-red-300">
          <span class="text-red-800 font-bold">De≈à 12‚Äì13: Fiset√≠n ‚Äì zabitie star√Ωch buniek (senol√Ωza)</span>
          <div class="flex items-center space-x-2">
            <button class="info-btn bg-red-200 text-red-800" data-info="fisetin" data-title="Fiset√≠n protokol ‚ÑπÔ∏è">‚ÑπÔ∏è</button>
            <input type="checkbox" id="monthly-day12-13" class="h-5 w-5 text-red-600 rounded focus:ring-red-500">
          </div>
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 15: 18 h p√¥st (len voda/ƒçaj/k√°va)</span>
          <input type="checkbox" id="monthly-day15" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 20: Sauna + ƒæadov√° voda (Mitochondrie)</span>
          <input type="checkbox" id="monthly-day20" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 22: 18‚Äì24 h p√¥st</span>
          <input type="checkbox" id="monthly-day22" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 25: De≈à s vysok√Ωmi polyfenolmi (olivov√Ω olej, bobule)</span>
          <input type="checkbox" id="monthly-day25" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>
        <div class="p-3 bg-indigo-50 rounded-xl shadow-sm flex justify-between items-center">
          <span class="text-gray-700 font-medium">De≈à 27: 10 min tr√©ning namiesto 5 (Svalov√Ω boost)</span>
          <input type="checkbox" id="monthly-day27" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
        </div>

        <button onclick="manualMonthlyReset()" class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg font-medium hover:bg-gray-300 transition mt-4">Manu√°lne Resetova≈• Mesaƒçn√Ω Protokol</button>
      </div>
    </div>

    <!-- 4. KRVN√â TESTY -->
    <div id="tests" class="content-section hidden">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">üß™ Anti-Aging Krvn√© Markery (2√ó roƒçne)</h2>
      <p class="text-sm text-gray-500 mb-4">Sleduj re√°lne ukazovatele biologick√©ho veku.</p>
      <div class="overflow-x-auto rounded-xl shadow-lg">
        <table class="min-w-full bg-white">
          <thead class="bg-gray-200 text-gray-600 uppercase text-xs leading-normal">
            <tr>
              <th class="py-3 px-6 text-left">Marker</th>
              <th class="py-3 px-6 text-left">Preƒço d√¥le≈æit√Ω</th>
              <th class="py-3 px-6 text-center">Ide√°lna hodnota</th>
            </tr>
          </thead>
          <tbody class="text-gray-600 text-sm font-light">
            <tr class="border-b border-gray-200 hover:bg-red-50">
              <td class="py-3 px-6 font-medium">CRP (Z√°pal)</td>
              <td class="py-3 px-6">R√Ωchlos≈• starnutia</td>
              <td class="py-3 px-6 text-center text-red-600 font-bold">&lt; 0,5 mg/L</td>
            </tr>
            <tr class="border-b border-gray-200 hover:bg-yellow-50">
              <td class="py-3 px-6 font-medium">Fasting Insulin</td>
              <td class="py-3 px-6">Inzul√≠nov√° citlivos≈•</td>
              <td class="py-3 px-6 text-center text-yellow-600 font-bold">&lt; 5 mIU/L</td>
            </tr>
            <tr class="border-b border-gray-200 hover:bg-green-50">
              <td class="py-3 px-6 font-medium">ApoB (Cievy)</td>
              <td class="py-3 px-6">Riziko infarktu</td>
              <td class="py-3 px-6 text-center text-green-600 font-bold">&lt; 80 mg/dL</td>
            </tr>
            <tr class="border-b border-gray-200 hover:bg-green-50">
              <td class="py-3 px-6 font-medium">Homocyste√≠n (DNA)</td>
              <td class="py-3 px-6">Metyl√°cia DNA, mozog</td>
              <td class="py-3 px-6 text-center text-green-600 font-bold">&lt; 9 ¬µmol/L</td>
            </tr>
            <tr class="border-b border-gray-200 hover:bg-yellow-50">
              <td class="py-3 px-6 font-medium">DHEA-S / Testoster√≥n</td>
              <td class="py-3 px-6">Anti-starn√∫ci horm√≥n / Libido</td>
              <td class="py-3 px-6 text-center text-yellow-600 font-bold">Horn√° 1/3 normy</td>
            </tr>
            <tr class="hover:bg-green-50">
              <td class="py-3 px-6 font-medium">Vitam√≠n D3</td>
              <td class="py-3 px-6">Imunita, horm√≥ny</td>
              <td class="py-3 px-6 text-center text-green-600 font-bold">40‚Äì60 ng/ml</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="mt-6 p-4 bg-yellow-50 rounded-xl shadow-md">
        <p class="text-sm text-yellow-800 font-medium">
          Pre ‚Äûskutoƒçn√Ω anti-aging monitoring‚Äú sleduj aj VO2max, grip strength a HRV. Epigenetick√© testy (Horvath/TruAge) 1√ó roƒçne.
        </p>
      </div>
    </div>
  </div>

  <!-- MODAL - N√°hrada za alert/confirm -->
  <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center p-4 z-50 transition-opacity duration-300">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
      <h3 id="modal-title" class="text-xl font-bold mb-4 text-gray-800">Potvrdenie</h3>
      <p id="modal-text" class="text-gray-600 mb-6">Text</p>
      <div id="modal-actions" class="flex justify-end space-x-3">
        <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition">Zavrie≈•</button>
        <button id="modal-confirm" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition">OK</button>
      </div>
    </div>
  </div>

  <script>
    // Tabs prep√≠nanie
    const tabButtons = document.querySelectorAll('.tab-button');
    const contentSections = document.querySelectorAll('.content-section');
    tabButtons.forEach(button=>{
      button.addEventListener('click', ()=>{
        const targetId = button.dataset.target;
        contentSections.forEach(s => s.classList.add('hidden'));
        document.getElementById(targetId).classList.remove('hidden');
        
        // Aktualiz√°cia akt√≠vneho tlaƒçidla
        tabButtons.forEach(btn => {
          btn.classList.remove('active','bg-blue-600','text-white');
          btn.classList.add('text-gray-600', 'hover:bg-gray-100');
        });
        button.classList.add('active','bg-blue-600','text-white');
        button.classList.remove('text-gray-600', 'hover:bg-gray-100');
      });
    });

    // Modal helper
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalText = document.getElementById('modal-text');
    const modalConfirm = document.getElementById('modal-confirm');

    window.closeModal = function(){
      modal.classList.add('hidden');
      document.querySelector('#modal-actions button:first-child').classList.remove('hidden');
    }

    // Modal pre potvrdenie (s OK/Cancel logikou)
    window.showModal = function(title, text, onConfirm, confirmLabel='Resetova≈•'){
      modalTitle.textContent = title;
      modalText.textContent = text;
      modal.classList.remove('hidden');

      // Vytvorenie nov√©ho Confirm tlaƒçidla na zabezpeƒçenie 'once: true'
      const newBtn = document.createElement('button');
      newBtn.id = 'modal-confirm-temp';
      newBtn.className = 'px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition';
      newBtn.textContent = confirmLabel;
      
      // Nahradenie p√¥vodn√©ho tlaƒçidla (aby sme sa vyhli duplicitn√Ωm listenerom)
      const oldBtn = document.getElementById('modal-confirm-temp') || modalConfirm;
      oldBtn.parentNode.replaceChild(newBtn, oldBtn);

      newBtn.addEventListener('click', ()=>{
        if (onConfirm) onConfirm();
        window.closeModal();
      }, { once: true });
    }

    // Modal pre inform√°cie (len OK logikou)
    window.infoModal = function(title, text, okLabel='OK'){
      modalTitle.textContent = title;
      modalText.textContent = text;
      modal.classList.remove('hidden');
      
      const confirmButton = document.getElementById('modal-confirm');
      
      // Klonovanie tlaƒçidla OK
      const newBtn = confirmButton.cloneNode(true);
      newBtn.id = 'modal-confirm-temp';
      newBtn.textContent = okLabel;
      newBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
      newBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
      
      const oldBtn = document.getElementById('modal-confirm-temp') || confirmButton;
      oldBtn.parentNode.replaceChild(newBtn, oldBtn);

      document.querySelector('#modal-actions button:first-child').classList.add('hidden');
      newBtn.addEventListener('click', window.closeModal, { once: true });
    }

    // Kolovanie info pre drepy (L1‚ÜíL2‚ÜíL3)
    window.cycleSquatInfo = function(){
      const lvlEl = document.getElementById('squat-level-val');
      const lvl = Number(lvlEl.dataset.level || 1);
      const map = {1:'drepy_L1', 2:'drepy_L2', 3:'drepy_L3'};
      const titles = {1:'Drepy ‚Äì Level 1 ‚ÑπÔ∏è', 2:'Drepy ‚Äì Level 2 ‚ÑπÔ∏è', 3:'Drepy ‚Äì Level 3 ‚ÑπÔ∏è'};
      const key = map[lvl];
      const text = window.INFO ? (window.INFO[key] || 'Popis ch√Ωba.') : 'Popis ch√Ωba (chyba naƒç√≠tania INFO d√°t).';
      window.infoModal(titles[lvl], text, 'OK');
    }

    // Manu√°lny reset ‚Äì denn√Ω
    window.manualDailyReset = () => {
      window.showModal("Reset Denn√©ho Re≈æimu", "Naozaj chce≈° manu√°lne resetova≈• denn√© √∫lohy? T√°to akcia vyma≈æe dne≈°n√© za≈°krtnutia, ale zachov√° Level Drepy/Streak.", () => {
        document.querySelectorAll('input[id^="daily-"]').forEach(cb => cb.checked = false);
        
        let state = buildStateFromUI();
        // Resetujeme len lastDailyReset na vƒçeraj≈°ok, aby pri najbli≈æ≈°om naƒç√≠tan√≠ do≈°lo k resetu denn√Ωch √∫loh
        const yesterday = new Date(Date.now()-86400000).toISOString().slice(0,10);
        state.lastDailyReset = yesterday;
        
        // Resetujeme tick, ale nie streak (ak to nebolo uroben√© dnes)
        if (state.lastSquatTick === todayStr()) {
          state.lastSquatTick = isYesterday(yesterday) ? yesterday : '';
        }
        
        window.saveChecklistState(state);
      }, 'Resetova≈•');
    };

    // Manu√°lny reset ‚Äì mesaƒçn√Ω
    window.manualMonthlyReset = () => {
      window.showModal("Reset Mesaƒçn√©ho Protokolu", "Naozaj chce≈° resetova≈• V≈†ETKY mesaƒçn√© √∫lohy (p√¥sty, fiset√≠n atƒè.)? Bud√∫ vynulovan√© aj v aktu√°lnom mesiaci. T√∫to akciu pou≈æite, ak chcete zaƒça≈• protokol odznova.", () => {
        document.querySelectorAll('input[id^="monthly-"]').forEach(cb => cb.checked = false);
        
        let state = buildStateFromUI();
        
        // Nastavenie lastMonthlyReset na minul√Ω mesiac, aby sa reset spustil
        const d = new Date();
        d.setMonth(d.getMonth() - 1);
        state.lastMonthlyReset = d.toISOString().slice(0, 7);
        
        // Odstr√°nenie star√Ωch mesaƒçn√Ωch kƒæ√∫ƒçov
        Object.keys(state).forEach(k=>{ if (k.startsWith('monthly-')) delete state[k]; });
        
        window.saveChecklistState(state);
      }, 'Resetova≈•');
    };
  </script>
    <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js");
  }
</script>

</body>
</html>
